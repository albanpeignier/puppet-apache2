<VirtualHost *:80>
    ServerName <%= name %>
    <% unless aliases.empty? %>
    ServerAlias <%= aliases.join(' ') %>
    <% end %>

    <% if preserve_host %>
      ProxyPreserveHost On
    <% end %>
    ProxyRequests Off

    <Proxy <%= target %>/*>
      Require all granted
    </Proxy>

    ProxyPass / <%= target %>/
    ProxyPassReverse / <%= target %>/

    <%= content %>

    <% if authentication %>
    <Location />
    AuthType Basic
    AuthName "Protected Area"
    AuthUserFile /etc/apache2/htpasswd

    Require valid-user
    </Location>
    <% end %>
</VirtualHost>

<% if ssl %>
<VirtualHost *:443>
    ServerName <%= name %>
    <% unless aliases.empty? %>
    ServerAlias <%= aliases.join(' ') %>
    <% end %>

    <% if preserve_host %>
      ProxyPreserveHost On
    <% end %>
    ProxyRequests Off

    <Proxy <%= target %>/*>
      Require all granted
    </Proxy>

    ProxyPass / <%= target %>/
    ProxyPassReverse / <%= target %>/

    <%= content %>

    <% if authentication %>
    <Location />
    AuthType Basic
    AuthName "Protected Area"
    AuthUserFile /etc/apache2/htpasswd

    Require valid-user
    </Location>
    <% end %>

    SSLEngine on
    Include /etc/apache2/ssl_params.conf
    Include /etc/apache2/<%= ssl %>_certs.conf
    SSLVerifyClient None
</VirtualHost>
<% end %>
